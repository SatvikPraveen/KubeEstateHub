# Location: `/manifests/operators/realestate-sync-crd.yaml`

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: realestatesyncs.realestate.kubeestatehub.io
  labels:
    app.kubernetes.io/name: realestate-sync-crd
    app.kubernetes.io/component: operator
    app.kubernetes.io/part-of: kubeestatehub
spec:
  group: realestate.kubeestatehub.io
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                source:
                  type: object
                  properties:
                    type:
                      type: string
                      enum: ["mls", "api", "csv", "xml"]
                    endpoint:
                      type: string
                    apiKey:
                      type: string
                    credentials:
                      type: object
                      properties:
                        secretRef:
                          type: object
                          properties:
                            name:
                              type: string
                            key:
                              type: string
                  required:
                    - type
                    - endpoint
                schedule:
                  type: string
                  pattern: '^(@(annually|yearly|monthly|weekly|daily|hourly|reboot))|(@every (\d+(ns|us|µs|ms|s|m|h))+)|((((\d+,)+\d+|(\d+(\/|-)\d+)|\d+|\*) ?){5,7})$'
                syncConfig:
                  type: object
                  properties:
                    batchSize:
                      type: integer
                      minimum: 1
                      maximum: 1000
                      default: 100
                    retryLimit:
                      type: integer
                      minimum: 0
                      maximum: 10
                      default: 3
                    timeout:
                      type: string
                      pattern: '^([0-9]+(\.[0-9]+)?(ns|us|µs|ms|s|m|h))+$'
                      default: "30m"
                    filters:
                      type: object
                      properties:
                        propertyTypes:
                          type: array
                          items:
                            type: string
                            enum:
                              [
                                "residential",
                                "commercial",
                                "industrial",
                                "land",
                              ]
                        priceRange:
                          type: object
                          properties:
                            min:
                              type: integer
                              minimum: 0
                            max:
                              type: integer
                              minimum: 0
                        location:
                          type: object
                          properties:
                            city:
                              type: string
                            state:
                              type: string
                            zipCode:
                              type: string
                            radius:
                              type: integer
                              minimum: 1
                              maximum: 100
                destination:
                  type: object
                  properties:
                    database:
                      type: object
                      properties:
                        connectionString:
                          type: string
                        table:
                          type: string
                          default: "listings"
                    webhook:
                      type: object
                      properties:
                        url:
                          type: string
                        method:
                          type: string
                          enum: ["POST", "PUT", "PATCH"]
                          default: "POST"
                        headers:
                          type: object
                          additionalProperties:
                            type: string
              required:
                - source
                - schedule
                - destination
            status:
              type: object
              properties:
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                        enum: ["True", "False", "Unknown"]
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
                    required:
                      - type
                      - status
                lastSyncTime:
                  type: string
                  format: date-time
                nextSyncTime:
                  type: string
                  format: date-time
                recordsProcessed:
                  type: integer
                  minimum: 0
                recordsSuccess:
                  type: integer
                  minimum: 0
                recordsFailure:
                  type: integer
                  minimum: 0
                phase:
                  type: string
                  enum: ["Pending", "Running", "Completed", "Failed", "Paused"]
      additionalPrinterColumns:
        - name: Source Type
          type: string
          jsonPath: .spec.source.type
        - name: Schedule
          type: string
          jsonPath: .spec.schedule
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Last Sync
          type: string
          jsonPath: .status.lastSyncTime
        - name: Records Processed
          type: integer
          jsonPath: .status.recordsProcessed
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
  scope: Namespaced
  names:
    plural: realestatesyncs
    singular: realestatesync
    kind: RealEstateSync
    shortNames:
      - res
      - resync
    categories:
      - realestate
